<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MotionLife Player Monitor</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  .fade-in { animation: fadeIn 0.6s ease-in-out; }
  @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  
  /* Custom scrollbar */
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: #374151;
    border-radius: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #10B981;
    border-radius: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #059669;
  }
  
  .ping-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
  }
  .ping-excellent { background-color: #10B981; }
  .ping-good { background-color: #22C55E; }
  .ping-medium { background-color: #F59E0B; }
  .ping-poor { background-color: #EF4444; }
</style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">

<!-- Loading Screen -->
<div id="loading-screen" class="fixed inset-0 bg-gray-900 flex items-center justify-center z-50">
  <div class="text-center">
    <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-green-400 mx-auto"></div>
    <p class="mt-4 text-green-400 text-xl font-bold">Loading Data...</p>
  </div>
</div>

<!-- Main Content -->
<div class="w-full max-w-4xl">
  <div class="text-center mb-6">
    <h1 class="text-4xl font-extrabold text-green-400">MotionLife Server Monitor</h1>
    <p class="text-gray-400 mt-2">Pantau pemain secara real-time</p>
  </div>

  <!-- Info Bar -->
  <div class="bg-gray-800 p-4 rounded-lg flex flex-wrap justify-between items-center mb-4">
    <div class="text-lg">Online: <span id="online-count" class="text-green-400 font-bold">0</span></div>
    <div class="flex items-center">
      <span class="text-sm text-gray-400 mr-2">Status Server:</span>
      <span id="server-status" class="px-2 py-1 rounded text-xs font-bold bg-green-400/20 text-green-400">Online</span>
    </div>
    <div class="text-sm text-gray-400">Refresh dalam: <span id="refresh-timer" class="font-bold">5</span>s</div>
  </div>

  <!-- Search Bar -->
  <div class="relative mb-4">
    <input type="text" id="search" placeholder="Cari player..." 
      class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-green-400 focus:outline-none text-white pl-10">
    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
  </div>

  <!-- Player List Header -->
  <div class="grid grid-cols-12 gap-2 px-4 py-2 text-gray-400 text-sm font-semibold">
    <div class="col-span-1 text-center">ID</div>
    <div class="col-span-7">Nama Player</div>
    <div class="col-span-4 text-center">Ping</div>
  </div>

  <!-- Player List -->
  <div id="player-list" class="bg-gray-800 p-4 rounded-lg shadow-lg grid grid-cols-1 gap-2 max-h-[500px] overflow-y-auto custom-scrollbar"></div>

  <!-- Server Info -->
  <div id="server-info" class="mt-4 p-4 bg-gray-800 rounded-lg text-sm text-gray-400">
    <div class="flex justify-between items-center">
      <div>
        <span id="server-name">Mengambil info server...</span>
      </div>
      <div>
        <span id="server-players">0/32</span> players
      </div>
    </div>
  </div>
</div>

<script>
// Fungsi untuk mencari server ID MotionLife
async function findMotionLifeServer() {
  try {
    // Daftar kemungkinan server ID untuk MotionLife (bisa ditambah sesuai kebutuhan)
    const possibleServerIds = ["5j433z", "motionlife", "motionliferp", "mlrp"];
    let serverData = null;
    
    for (const id of possibleServerIds) {
      try {
        const response = await fetch(`https://servers-frontend.fivem.net/api/servers/single/${id}`);
        if (response.ok) {
          const data = await response.json();
          // Cek apakah server ini adalah MotionLife (dengan memeriksa nama)
          if (data.Data && data.Data.hostname && data.Data.hostname.toLowerCase().includes("motionlife")) {
            serverData = { id: id, data: data };
            break;
          }
        }
      } catch (e) {
        console.log(`Server ID ${id} tidak valid:`, e);
      }
    }
    
    return serverData;
  } catch (error) {
    console.error("Error mencari server:", error);
    return null;
  }
}

const refreshInterval = 15; // Detik
let countdown = refreshInterval;
let currentServerId = null;

// Ambil elemen
const loadingScreen = document.getElementById("loading-screen");
const onlineCountEl = document.getElementById("online-count");
const refreshTimerEl = document.getElementById("refresh-timer");
const playerListEl = document.getElementById("player-list");
const serverNameEl = document.getElementById("server-name");
const serverPlayersEl = document.getElementById("server-players");
const serverStatusEl = document.getElementById("server-status");

// Fungsi untuk mendapatkan kelas warna berdasarkan nilai ping
function getPingColorClass(ping) {
  if (ping < 50) return "ping-excellent";
  if (ping < 100) return "ping-good";
  if (ping < 200) return "ping-medium";
  return "ping-poor";
}

async function fetchData() {
  try {
    // Jika belum memiliki server ID, cari dulu
    if (!currentServerId) {
      loadingScreen.querySelector('p').textContent = "Mencari server MotionLife...";
      const serverInfo = await findMotionLifeServer();
      
      if (serverInfo) {
        currentServerId = serverInfo.id;
        // Tampilkan info server
        serverNameEl.textContent = serverInfo.data.Data.hostname;
        updateServerInfo(serverInfo.data);
      } else {
        throw new Error("Server MotionLife tidak ditemukan");
      }
    }
    
    const apiURL = `https://servers-frontend.fivem.net/api/servers/single/${currentServerId}`;
    const res = await fetch(apiURL);
    const data = await res.json();

    // Update data
    const players = data.Data.players;
    const onlineCount = data.Data.clients;
    onlineCountEl.textContent = onlineCount;
    
    // Update info server
    updateServerInfo(data);

    // Render list pemain
    playerListEl.innerHTML = "";
    
    if (players.length === 0) {
      playerListEl.innerHTML = `
        <div class="text-center py-8 text-gray-400">
          <i class="fas fa-users-slash text-4xl mb-2"></i>
          <p>Tidak ada pemain online</p>
        </div>
      `;
    } else {
      players.forEach(player => {
        const ping = player.ping || 0;
        const pingColorClass = getPingColorClass(ping);
        
        const div = document.createElement("div");
        div.className = "fade-in grid grid-cols-12 gap-2 bg-gray-700 p-3 rounded-lg items-center";
        div.innerHTML = `
          <div class="col-span-1 text-center text-gray-400">${player.id}</div>
          <div class="col-span-7 truncate">${player.name}</div>
          <div class="col-span-4 text-center">
            <span class="${pingColorClass} ping-indicator"></span>
            <span>${ping}ms</span>
          </div>
        `;
        playerListEl.appendChild(div);
      });
    }

    // Hilangkan loading screen setelah load pertama
    loadingScreen.style.display = "none";

  } catch (error) {
    console.error("Gagal mengambil data:", error);
    loadingScreen.querySelector('p').textContent = "Error: " + error.message;
    
    // Coba lagi dalam 10 detik jika server ID tidak ditemukan
    setTimeout(() => {
      currentServerId = null;
      fetchData();
    }, 10000);
  }
}

function updateServerInfo(data) {
  if (data && data.Data) {
    serverNameEl.textContent = data.Data.hostname;
    serverPlayersEl.textContent = `${data.Data.clients}/${data.Data.info.maxClients || 32}`;
  }
}

function startCountdown() {
  countdown = refreshInterval;
  refreshTimerEl.textContent = countdown;
  const timer = setInterval(() => {
    countdown--;
    refreshTimerEl.textContent = countdown;
    if (countdown <= 0) {
      clearInterval(timer);
      fetchData();
      startCountdown();
    }
  }, 1000);
}

// Fitur Search
document.getElementById("search").addEventListener("input", function() {
  const filter = this.value.toLowerCase();
  const players = document.querySelectorAll("#player-list > div");
  
  players.forEach(player => {
    const playerName = player.querySelector('.truncate').textContent.toLowerCase();
    if (playerName.includes(filter)) {
      player.style.display = "grid";
    } else {
      player.style.display = "none";
    }
  });
});

// Inisialisasi
fetchData();
startCountdown();
</script>

</body>
</html>
